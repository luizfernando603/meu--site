<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Contato - Barbearia do Luiz</title>
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #2c2c2c, #444);
      color: #fff;
      margin: 0;
      padding: 0;
    }
    header {
      text-align: center;
      padding: 2rem;
      background-color: #000;
    }
    header h1 {
      color: #f5b642;
      margin-bottom: 0.5rem;
    }
    .container {
      max-width: 600px;
      margin: 2rem auto;
      background: #333;
      padding: 2rem;
      border-radius: 12px;
      box-shadow: 0 0 15px rgba(0,0,0,0.5);
    }
    h2 {
      color: #f5b642;
      text-align: center;
      margin-bottom: 1rem;
    }
    input, textarea, button {
      width: 100%;
      padding: 0.8rem;
      margin-bottom: 1rem;
      border-radius: 8px;
      border: none;
      font-size: 1rem;
    }
    input, textarea {
      background: #555;
      color: #fff;
    }
    button {
      background: #25D366;
      color: #fff;
      font-weight: bold;
      cursor: pointer;
      transition: 0.3s;
    }
    button:hover {
      background: #1ebe5d;
    }
    .horarios {
      text-align: center;
      margin-top: 2rem;
      padding: 1rem;
      background: #222;
      border-radius: 8px;
    }
    .horarios p {
      margin: 0.3rem 0;
    }
    footer {
      text-align: center;
      padding: 1rem;
      background: #000;
      color: #aaa;
    }
  </style>
</head>
<body>
  <header>
    <h1>Barbearia do Luiz üíà</h1>
    <p>Seu estilo, seu momento!</p>
  </header>

  <div class="container">
    <h2>Entre em Contato</h2>
    <input type="text" id="nome" placeholder="Seu nome" required>
    <input type="tel" id="telefone" placeholder="Seu WhatsApp" required>
    <textarea id="mensagem" rows="4" placeholder="Mensagem ou agendamento" required></textarea>
    <button onclick="enviarWhatsApp()">Enviar pelo WhatsApp</button>

    <div class="horarios">
      <h2>Hor√°rios de Atendimento</h2>
      <div id="weekCalendar" style="display:flex;justify-content:space-between;margin:0.5rem 0;gap:0.4rem;">
        <!-- Dias da semana ser√£o renderizados por JS -->
      </div>
       <div id="slots" class="slots"></div>
      <p id="summary"></p>
      <p id="selectedDateLabel" style="color:#ccc;margin-top:.5rem;"></p>
      <button id="adminBtn" style="background:#444;width:auto;padding:.5rem;border-radius:6px;margin-top:1rem;">√Årea Admin</button>

      <div id="adminPanel" style="display:none;margin-top:1rem;background:#2b2b2b;padding:1rem;border-radius:8px;">
        <h3 style="color:#f5b642;margin-top:0;">Painel Admin</h3>
        <p>Senha: <strong>admin123</strong> (padr√£o). Use para marcar reservas quando receber 'SIM' no seu WhatsApp.</p>
        <div id="pendingList"></div>
        <div id="adminSlots"></div>
        <button id="closeAdmin" style="margin-top:0.5rem;background:#f5b642;color:#000;">Fechar Admin</button>
      </div>
    </div>
  </div>

  <footer>
    <p>¬© 2025 Barbearia do Luiz ‚Äî Todos os direitos reservados.</p>
  </footer>

  <script>
    // ======= Configura√ß√£o de hor√°rios =======
    const SLOT_KEY = 'barbearia_reservas_v1';
    const PENDING_KEY = 'barbearia_pendentes_v1';
    let selectedDate = null; // formato 'YYYY-MM-DD'
    const meuWhats = '+5527998183827'; // n√∫mero do sal√£o (com c√≥digo do pa√≠s+DDD)

    function formatDate(d) {
      return d.toISOString().slice(0,10);
    }
    function getWeekDates() {
      const today = new Date();
      // encontrar segunda-feira da semana atual
      const day = today.getDay(); // 0=domingo
      const diffToMonday = (day === 0) ? -6 : 1 - day;
      const monday = new Date(today);
      monday.setDate(today.getDate() + diffToMonday);
      const dates = [];
      for (let i=0;i<6;i++) { // seg-sab
        const d = new Date(monday);
        d.setDate(monday.getDate() + i);
        dates.push(d);
      }
      return dates;
    }

    function renderWeekCalendar() {
      const cal = document.getElementById('weekCalendar');
      cal.innerHTML = '';
      const dates = getWeekDates();
      const reservasAll = getStorage(SLOT_KEY, {});
      dates.forEach(d => {
        const dateKey = formatDate(d);
        const box = document.createElement('div');
        box.style.flex = '1';
        box.style.padding = '0.5rem';
        box.style.borderRadius = '6px';
        box.style.textAlign = 'center';
        box.style.cursor = 'pointer';
        box.style.background = '#2b2b2b';
        box.style.border = '1px solid #3a3a3a';
        const short = d.toLocaleDateString('pt-BR',{weekday:'short'});
        box.innerHTML = `<div style="font-weight:bold;">${short}</div><div style="font-size:0.85rem;margin-top:0.3rem;">${d.getDate()}</div>`;
        // marcar se j√° tiver reservas para essa data
        const dayReservations = reservasAll[dateKey] || {};
        const reservedCount = Object.keys(dayReservations).length;
        if (reservedCount>0) {
          const dot = document.createElement('div');
          dot.style.width = '10px';
          dot.style.height = '10px';
          dot.style.background = '#aa2b2b';
          dot.style.borderRadius = '50%';
          dot.style.margin = '6px auto 0';
          box.appendChild(dot);
        }
        box.onclick = () => { selectedDate = dateKey; renderSlots(); renderWeekCalendar(); };
        if (selectedDate === null) selectedDate = formatDate(dates[0]);
        if (selectedDate === dateKey) {
          box.style.outline = '2px solid #f5b642';
        }
        cal.appendChild(box);
      });
      document.getElementById('selectedDateLabel').textContent = `Dia selecionado: ${selectedDate}`;
    }

    function getStorage(key, defaultValue) {
      try {
        return JSON.parse(localStorage.getItem(key)) || defaultValue;
      } catch { return defaultValue; }
    }
    function setStorage(key, value) { localStorage.setItem(key, JSON.stringify(value)); }

    function gerarHorarios() {
      // gera hor√°rios de 30 em 30 minutos entre 8:00 e 18:30
      const slots = [];
      const start = new Date();
      start.setHours(8,0,0,0); // come√ßa √†s 08:00
      const end = new Date();
      end.setHours(18,30,0,0);
      let cur = new Date(start);
      while (cur <= end) {
        const h = String(cur.getHours()).padStart(2,'0');
        const m = String(cur.getMinutes()).padStart(2,'0');
        slots.push(`${h}:${m}`);
        cur.setMinutes(cur.getMinutes() + 30);
      }
      return slots;
    }

    function renderSlots() {
      const slotsDiv = document.getElementById('slots');
      const adminSlots = document.getElementById('adminSlots');
      const pendingList = document.getElementById('pendingList');
      const slots = gerarHorarios();
      const reservasAll = getStorage(SLOT_KEY, {}); // { 'YYYY-MM-DD': { '07:30': {status:'reserved', nome...}}}
      const pendAll = getStorage(PENDING_KEY, {});
      const reservas = reservasAll[selectedDate] || {};
      const pendentes = pendAll[selectedDate] || {};

      slotsDiv.innerHTML = '';
      adminSlots.innerHTML = '';
      pendingList.innerHTML = '';

      let disponiveis = 0;
      slots.forEach(slot => {
        const status = reservas[slot] && reservas[slot].status ? reservas[slot].status : 'free';

        const slotEl = document.createElement('div');
        slotEl.style.display = 'flex';
        slotEl.style.justifyContent = 'space-between';
        slotEl.style.alignItems = 'center';
        slotEl.style.margin = '0.4rem 0';

        const label = document.createElement('div');
        label.textContent = slot;

        const btn = document.createElement('button');
        btn.style.width = '48%';
        btn.style.padding = '0.6rem';
        btn.style.borderRadius = '8px';
        btn.style.border = 'none';
        btn.style.cursor = 'pointer';

        if (status === 'reserved') {
          btn.textContent = `Reservado (${reservas[slot].nome || '‚Äî'})`;
          btn.disabled = true;
          btn.style.background = '#aa2b2b';
          btn.title = 'Este hor√°rio j√° est√° reservado';
        } else if (pendentes[slot]) {
          btn.textContent = `Pendente: ${pendentes[slot].nome}`;
          btn.style.background = '#f39c12';
          btn.disabled = true; // impede novo clique enquanto estiver pendente
          btn.title = 'Solicita√ß√£o pendente ‚Äî aguarde confirma√ß√£o';
        } else {
          btn.textContent = 'Reservar';
          btn.style.background = '#25D366';
          disponiveis++;
          btn.disabled = false;
          btn.onclick = () => requestSlot(slot); // s√≥ ativa para slots livres
        }

        slotEl.appendChild(label);
        slotEl.appendChild(btn);
        slotsDiv.appendChild(slotEl);

        // admin list
        const aRow = document.createElement('div');
        aRow.style.display = 'flex';
        aRow.style.justifyContent = 'space-between';
        aRow.style.margin = '0.25rem 0';
        aRow.innerHTML = `<div>${slot} ‚Äî ${status}</div>`;
        const aBtn = document.createElement('button');
        aBtn.style.marginLeft = '0.5rem';
        aBtn.textContent = status === 'reserved' ? 'Liberar' : 'Marcar Reservado';
        aBtn.onclick = () => {
          if (status === 'reserved') {
            // remove reserva do dia
            const all = getStorage(SLOT_KEY, {});
            if (all[selectedDate]) { delete all[selectedDate][slot]; setStorage(SLOT_KEY, all); }
            renderSlots();
          } else {
            const nome = prompt('Nome do cliente que confirmou (SIM):');
            const all = getStorage(SLOT_KEY, {});
            if (!all[selectedDate]) all[selectedDate] = {};
            all[selectedDate][slot] = { status: 'reserved', nome: nome || '‚Äî', confirmAt: new Date().toISOString() };
            // limpar pendente se existir
            const pAll = getStorage(PENDING_KEY, {});
            if (pAll[selectedDate]) { delete pAll[selectedDate][slot]; setStorage(PENDING_KEY, pAll); }
            setStorage(SLOT_KEY, all);
            renderSlots();
          }
        };
        aRow.appendChild(aBtn);
        adminSlots.appendChild(aRow);
      });

      // render pendentes
      const pendDay = getStorage(PENDING_KEY, {})[selectedDate] || {};
      const pendKeys = Object.keys(pendDay);
      if (pendKeys.length === 0) {
        pendingList.innerHTML = '<p style="color:#bbb;">Nenhuma solicita√ß√£o pendente para este dia.</p>';
      } else {
        pendKeys.forEach(k => {
          const item = pendDay[k];
          const row = document.createElement('div');
          row.style.borderTop = '1px solid #3a3a3a';
          row.style.padding = '0.5rem 0';
          row.innerHTML = `<strong>${k}</strong> ‚Äî ${item.nome} ‚Äî ${item.telefone}<br>${item.mensagem}`;
          const btnConfirm = document.createElement('button');
          btnConfirm.textContent = 'Confirmar (marcar reservado)';
          btnConfirm.style.marginLeft = '0.5rem';
          btnConfirm.onclick = () => {
            const all = getStorage(SLOT_KEY, {});
            if (!all[selectedDate]) all[selectedDate] = {};
            all[selectedDate][k] = { status: 'reserved', nome: item.nome, confirmAt: new Date().toISOString() };
            setStorage(SLOT_KEY, all);
            const pAll = getStorage(PENDING_KEY, {});
            delete pAll[selectedDate][k];
            setStorage(PENDING_KEY, pAll);
            renderSlots();
            renderWeekCalendar();
          };
          row.appendChild(btnConfirm);
          pendingList.appendChild(row);
        });
      }

      document.getElementById('summary').textContent = `Dispon√≠veis: ${disponiveis} / ${slots.length}`;
      document.getElementById('selectedDateLabel').textContent = `Dia selecionado: ${selectedDate}`;
      renderWeekCalendar();
    }

    function requestSlot(slot) {
      // bloqueia se j√° reservado ou pendente para a data selecionada
      const reservasAll = getStorage(SLOT_KEY, {});
      const pendAll = getStorage(PENDING_KEY, {});
      const reservasDay = reservasAll[selectedDate] || {};
      const pendDay = pendAll[selectedDate] || {};
      if (reservasDay[slot] && reservasDay[slot].status === 'reserved') {
        alert('Desculpe, este hor√°rio j√° foi reservado para este dia.');
        return;
      }
      if (pendDay[slot]) {
        alert('J√° existe uma solicita√ß√£o pendente para este hor√°rio neste dia. Aguarde a confirma√ß√£o.');
        return;
      }

      // pega dados do formul√°rio (o usu√°rio deve preencher antes)
      const nome = document.getElementById('nome').value.trim();
      const telefoneCliente = document.getElementById('telefone').value.trim();
      const mensagem = document.getElementById('mensagem').value.trim();

      if (!nome || !telefoneCliente) {
        alert('Por favor, preencha seu nome e telefone antes de reservar.');
        return;
      }

      // salva como pendente para o admin verificar (por data)
      const pend = getStorage(PENDING_KEY, {});
      if (!pend[selectedDate]) pend[selectedDate] = {};
      pend[selectedDate][slot] = { nome, telefone: telefoneCliente, mensagem, requestedAt: new Date().toISOString() };
      setStorage(PENDING_KEY, pend);

      const texto = `Ol√°, gostaria de reservar o hor√°rio ${slot} na Barbearia do Luiz em ${selectedDate}.\nNome: ${nome}.\nWhatsApp: ${telefoneCliente}.\nMensagem: ${mensagem || '-'}\nPor favor, responda SIM para confirmar.`;
      const url = `https://wa.me/${meuWhats.replace(/[^0-9]/g,'')}?text=${encodeURIComponent(texto)}`;
      window.open(url, '_blank');
      renderSlots();
    }

    // formul√°rio principal (enviar mensagem livre)
    function enviarWhatsApp() {
      const nome = document.getElementById('nome').value.trim();
      const telefoneCliente = document.getElementById('telefone').value.trim();
      const mensagem = document.getElementById('mensagem').value.trim();

      if (!nome || !telefoneCliente || !mensagem) {
        alert('Por favor, preencha todos os campos!');
        return;
      }

      const texto = `Ol√°, meu nome √© ${nome}. Meu WhatsApp √© ${telefoneCliente}. ${mensagem}`;
      const url = `https://wa.me/${meuWhats.replace(/[^0-9]/g,'')}?text=${encodeURIComponent(texto)}`;
      window.open(url, '_blank');
    }

    // admin
    document.getElementById('adminBtn').addEventListener('click', () => {
      const senha = prompt('Digite a senha do admin:');
      if (senha === 'LUIZ_PROGRAMADOR_1234') {
        document.getElementById('adminPanel').style.display = 'block';
      } else {
        alert('Senha incorreta');
      }
    });
    document.getElementById('closeAdmin').addEventListener('click', () => {
      document.getElementById('adminPanel').style.display = 'none';
    });

    // instru√ß√£o r√°pida
    document.addEventListener('DOMContentLoaded', () => {
      const containerTitle = document.querySelector('.horarios h2');
      if (containerTitle) containerTitle.textContent = 'Hor√°rios de Atendimento ‚Äî selecione um dia e um hor√°rio (08:00‚Äì18:30)';
    });

    // inicializa
    renderSlots();

  </script>
</body>
</html>
